#!/bin/bash

shortname()
{
    echo "recovervar"
}

name()
{
    echo "$(shortname) io=$(iolib_id_to_name $iolib) L=$level diffsize=$diffsize head=0 keep=0 inline=(1,1,1)"
}

setup()
{
    iolib=$1
    level=$2
    diffsize=$3
    
    fti_config_set "ckpt_io" "$iolib"
    fti_config_set "keep_last_ckpt" "0"
}

teardown()
{
    unset iolib
    unset level
    unset diffsize
}

runtest()
{
    app_run_normal ./recoverVar/recoverVar.exe $cfgfile 1 $level 1
    
    run_id="$(fti_config_get 'exec_id')"

    app_run_interrupt ./recoverVar/recoverVar.exe $cfgfile 0 $level $diffsize
    assert_equals $? 0 "$(print_test_status $?)"
}

print_test_status() {
    # Pretty string for the exit status of the recovervar application
    #
    # Parameters:
    # $1: The integer return value of a recovervar run

    if [ $1 = 255 ]; then
        echo "FTI Abort"
    elif [ $1 = 30 ]; then
        echo "Checkpoint Data Corrupted"
    elif [ $1 = 20 ]; then
        echo "Recovery Failed"
    elif [ $1 = 143 ]; then
        echo "Process Killed, Timeout"
    elif [ $1 = 40 ]; then
        echo "Test Data Corrupted"
    elif [ $1 = 50 ]; then
        echo "Wrong Environment"
    else
        echo "Unknown Return Value ($1)"
    fi
}