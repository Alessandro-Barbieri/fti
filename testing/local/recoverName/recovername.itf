#!/bin/bash

itf_load_module 'parameters' 'fti'

standard() {
    # Brief:
    # Tests the default behavior of the recoverName functionality
    #
    # Details:
    # Run the first application with recovername and simulate a crash.
    # Next, re-run the application and expect the application to recover.

    local app="$(dirname ${BASH_SOURCE[0]})/recoverName.exe"

    param_parse '+iolib' '+level' $@

    fti_config_set 'head' 0
    fti_config_set 'keep_last_ckpt' 0
    fti_config_set 'ckpt_io' $iolib

    fti_run_success $app ${itf_cfg['fti:config']} 1 $level 1
    fti_run_success $app ${itf_cfg['fti:config']} 0 $level 1
    pass
}

# Register all test cases for the parametrized test
for iolib in ${fti_io_ids[@]}; do
    for level in ${fti_levels[@]}; do
        if [ $iolib -eq 3 ]; then
            break # TODO: Remove this test when the feature gets implemented
        fi
        itf_case 'standard' "--iolib=$iolib" "--level=$level"
    done
done
