#!/bin/bash

itf_load_module 'parameters' 'fti'

recovervar_standard() {
    # Brief:
    # Tests the default behavior of the recovervar functionality
    #
    # Details:
    # Run the first application with recovervar and simulate a crash.
    # Next, re-run the application and expect the application to recover.

    local app="$(dirname ${BASH_SOURCE[0]})/recoverVar.exe"

    param_parse '+iolib' '+level' $@

    fti_config_set 'head' 0
    fti_config_set 'keep_last_ckpt' 0
    fti_config_set 'iolib' $iolib
    fti_config_set 'level' $level

    fti_run_success $app ${itf_cfg['fti:config']} 1 $level 1
    fti_run_success $app ${itf_cfg['fti:config']} 0 $level 1
    pass
}

# Register all test cases for the parametrized test
for iolib in ${fti_io_ids[@]}; do
    for level in ${fti_levels[@]}; do
        itf_case 'recovervar_standard' "--iolib=$iolib" "--level=$level"
    done
done
