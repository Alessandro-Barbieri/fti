set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DGPUSUPPORT")
set(CUDA_NVCC_FLAGS "${CUDA_NVCC_FLAGS} -DGPUSUPPORT -lineinfo")
add_executable(stressUVA.exe stressUVA.c cudaCode.cu)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DGPUSUPPORT")
string(STRIP ${MPI_C_LIBRARIES} MPI_C_LIBRARIES)
string(STRIP ${MPI_C_LINK_FLAGS} MPI_C_LINK_FLAGS)


target_link_libraries(stressUVA.exe -L${PROJECT_BINARY_DIR}/lib fti m cuda ${MPI_C_LIBRARIES} ${CUDA_LIBRARIES} ${MPI_C_LINK_FLAGS})


configure_file(config.fti.in ${CMAKE_CURRENT_SOURCE_DIR}/config.fti @ONLY)
set(INSTALL_DIR ${CMAKE_INSTALL_PREFIX})  

#HERE WE CREATE SINGLE NODE EXECUTIONS  
set(SIZE 48)  
set(NUMTASKS 4)  
set(CPUSPERTASK 40)  
set(EXP "SingleSmall")  

configure_file(test.sh.in ${CMAKE_CURRENT_SOURCE_DIR}/SingleSmall.sh @ONLY)

set(NUMTASKS 32)  
set(CPUSPERTASK 5)  
set(EXP "SingleBig")  
configure_file(test.sh.in ${CMAKE_CURRENT_SOURCE_DIR}/SingleBig.sh @ONLY)

#HERE WE CREATE SINGLE NODE EXECUTIONS  
set(SIZE 768)  
set(NUMTASKS 64)  
set(CPUSPERTASK 40)  
set(EXP "MultiSmall")  

configure_file(test.sh.in ${CMAKE_CURRENT_SOURCE_DIR}/MultiSmall.sh @ONLY)

set(NUMTASKS 512)  
set(CPUSPERTASK 5)  
set(EXP "MultiBig")  
configure_file(test.sh.in ${CMAKE_CURRENT_SOURCE_DIR}/MultiBig.sh @ONLY)




set_property(TARGET stressUVA.exe PROPERTY C_STANDARD 99)  
set_property(TARGET stressUVA.exe APPEND PROPERTY COMPILE_FLAGS ${MPI_C_COMPILE_FLAGS})
set_property(TARGET stressUVA.exe APPEND PROPERTY LINK_FLAGS ${MPI_C_LINK_FLAGS})


#set_property(TARGET stressUVA.exe APPEND PROPERTY COMPILE_FLAGS "-L${CMAKE_INSTALL_PREFIX}/include")

file(INSTALL config.fti DESTINATION ${CMAKE_CURRENT_BINARY_DIR} PERMISSIONS OWNER_READ OWNER_WRITE  GROUP_READ GROUP_WRITE  WORLD_READ WORLD_WRITE)
file(INSTALL SingleSmall.sh DESTINATION ${CMAKE_CURRENT_BINARY_DIR} PERMISSIONS OWNER_READ OWNER_WRITE  GROUP_READ GROUP_WRITE  WORLD_READ WORLD_WRITE)
file(INSTALL SingleBig.sh DESTINATION ${CMAKE_CURRENT_BINARY_DIR} PERMISSIONS OWNER_READ OWNER_WRITE  GROUP_READ GROUP_WRITE  WORLD_READ WORLD_WRITE)
file(INSTALL MultiSmall.sh DESTINATION ${CMAKE_CURRENT_BINARY_DIR} PERMISSIONS OWNER_READ OWNER_WRITE  GROUP_READ GROUP_WRITE  WORLD_READ WORLD_WRITE)
file(INSTALL MultiBig.sh DESTINATION ${CMAKE_CURRENT_BINARY_DIR} PERMISSIONS OWNER_READ OWNER_WRITE  GROUP_READ GROUP_WRITE  WORLD_READ WORLD_WRITE)

